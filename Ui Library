local Players = game:GetService('Players')
local UserInputService = game:GetService('UserInputService')
local TweenService = game:GetService('TweenService')
local RunService = game:GetService('RunService')

local player = Players.LocalPlayer
local playerGui = player:WaitForChild('PlayerGui')

-- Configuration
local CONFIG = {
    WINDOW = {
        SIZE = UDim2.new(0, 240, 0, 320),
        MINIMIZED_SIZE = UDim2.new(0, 240, 0, 40),
        POSITION = UDim2.new(0.9, -200, 0, 150),
        BACKGROUND_COLOR = Color3.fromRGB(15, 15, 20),
        ACCENT_COLOR = Color3.fromRGB(0, 150, 255),
    },
    BUTTON = {
        HEIGHT = 30,
        SPACING = 5,
        MAIN_COLOR = Color3.fromRGB(25, 25, 35),
        HOVER_COLOR = Color3.fromRGB(40, 40, 50),
        ACTIVE_COLOR = Color3.fromRGB(0, 100, 200),
    },
    TEXT = {
        TITLE_FONT = Enum.Font.GothamBlack,
        TITLE_SIZE = 18,
        BODY_FONT = Enum.Font.Gotham,
        BODY_SIZE = 11,
        KEYBIND_SIZE = 10,
    },
}

-- Create main GUI
local screenGui = Instance.new('ScreenGui')
screenGui.Name = 'ShadowStealHelper'
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local mainFrame = Instance.new('Frame')
mainFrame.Size = CONFIG.WINDOW.SIZE
mainFrame.Position = CONFIG.WINDOW.POSITION
mainFrame.BackgroundColor3 = CONFIG.WINDOW.BACKGROUND_COLOR
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
mainFrame.Active = true
mainFrame.Draggable = true

-- Enhanced shadow effect
local shadow = Instance.new('ImageLabel')
shadow.Name = 'SYLLINSE'
shadow.Size = UDim2.new(1, 20, 1, 20)
shadow.Position = UDim2.new(0, -10, 0, -10)
shadow.BackgroundTransparency = 1
shadow.Image = 'rbxassetid://5554236805'
shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
shadow.ImageTransparency = 0.8
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(23, 23, 277, 277)
shadow.ZIndex = -1
shadow.Parent = mainFrame

-- Background styling
local gradient = Instance.new('UIGradient')
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 35)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(10, 10, 15)),
})
gradient.Rotation = 90
gradient.Parent = mainFrame

local outline = Instance.new('UIStroke')
outline.Color = Color3.fromRGB(60, 60, 80)
outline.Thickness = 2
outline.Parent = mainFrame

-- Header
local header = Instance.new('Frame')
header.Size = UDim2.new(1, 0, 0, 40)
header.Position = UDim2.new(0, 0, 0, 0)
header.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
header.BackgroundTransparency = 0.7
header.BorderSizePixel = 0
header.Parent = mainFrame

local headerGradient = Instance.new('UIGradient')
headerGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 0, 0)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30)),
})
headerGradient.Rotation = 90
headerGradient.Parent = header

local accent = Instance.new('Frame')
accent.Size = UDim2.new(1, 0, 0, 2)
accent.Position = UDim2.new(0, 0, 1, -2)
accent.BackgroundColor3 = CONFIG.WINDOW.ACCENT_COLOR
accent.BorderSizePixel = 0
accent.Parent = header

-- Title section
local titleContainer = Instance.new('Frame')
titleContainer.Size = UDim2.new(1, -50, 1, 0)
titleContainer.Position = UDim2.new(0, 10, 0, 0)
titleContainer.BackgroundTransparency = 1
titleContainer.Parent = header

local title = Instance.new('TextLabel')
title.Size = UDim2.new(1, 0, 0.6, 0)
title.Position = UDim2.new(0, 0, 0, 2)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Text = 'SYLLINSE'
title.Font = CONFIG.TEXT.TITLE_FONT
title.TextSize = CONFIG.TEXT.TITLE_SIZE
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextYAlignment = Enum.TextYAlignment.Bottom
title.Parent = titleContainer

local subtitle = Instance.new('TextLabel')
subtitle.Size = UDim2.new(1, 0, 0.4, 0)
subtitle.Position = UDim2.new(0, 0, 0.6, 0)
subtitle.BackgroundTransparency = 1
subtitle.TextColor3 = Color3.fromRGB(180, 180, 220)
subtitle.Text = 'STEAL HELPER'
subtitle.Font = CONFIG.TEXT.BODY_FONT
subtitle.TextSize = 14
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.TextYAlignment = Enum.TextYAlignment.Top
subtitle.Parent = titleContainer

-- Window controls
local controls = Instance.new('Frame')
controls.Size = UDim2.new(0, 40, 1, 0)
controls.Position = UDim2.new(1, -45, 0, 0)
controls.BackgroundTransparency = 1
controls.Parent = header

local function createControlButton(text, position)
    local button = Instance.new('TextButton')
    button.Size = UDim2.new(0, 16, 0, 16)
    button.Position = position
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    button.BorderSizePixel = 0
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.Parent = controls

    local outline = Instance.new('UIStroke')
    outline.Color = Color3.fromRGB(80, 80, 100)
    outline.Thickness = 1
    outline.Parent = button

    return button
end

local minimizeBtn = createControlButton('−', UDim2.new(0, 2, 0, 10))
local closeBtn = createControlButton('×', UDim2.new(0, 20, 0, 10))

-- Content area
local contentContainer = Instance.new('Frame')
contentContainer.Size = UDim2.new(1, 0, 1, -40)
contentContainer.Position = UDim2.new(0, 0, 0, 40)
contentContainer.BackgroundTransparency = 1
contentContainer.Parent = mainFrame

-- Scroll frame for unlimited buttons
local scrollFrame = Instance.new('ScrollingFrame')
scrollFrame.Size = UDim2.new(1, 0, 1, 0)
scrollFrame.Position = UDim2.new(0, 0, 0, 0)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 4
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(60, 60, 80)
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.Parent = contentContainer

local buttonLayout = Instance.new('UIListLayout')
buttonLayout.Padding = UDim.new(0, CONFIG.BUTTON.SPACING)
buttonLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
buttonLayout.SortOrder = Enum.SortOrder.LayoutOrder
buttonLayout.Parent = scrollFrame

-- Data management
local buttonStates = {}
local keybindButtons = {}
local allButtonFrames = {}

-- Keybind system
local function saveKeybinds()
    if not writefile then
        return
    end

    local keybindData = {}
    for buttonName, keybindInfo in pairs(keybindButtons) do
        keybindData[buttonName] = keybindInfo.currentKey
    end

    pcall(function()
        writefile(
            'syllinse.json',
            game:GetService('HttpService'):JSONEncode(keybindData)
        )
    end)
end

local function loadKeybinds()
    if not readfile or not isfile or not isfile('syllinse.json') then
        return
    end

    pcall(function()
        local data = game:GetService('HttpService')
            :JSONDecode(readfile('syllinse.json'))
        for buttonName, key in pairs(data) do
            if keybindButtons[buttonName] then
                keybindButtons[buttonName].currentKey = key
                keybindButtons[buttonName].button.Text = key
            end
        end
    end)
end

local function updateKeybind(buttonName, newKey)
    if keybindButtons[buttonName] then
        keybindButtons[buttonName].currentKey = newKey
        keybindButtons[buttonName].button.Text = newKey
        saveKeybinds()
    end
end

-- Enhanced button creation system
local function createButton(parent, text, callback, defaultKey)
    local buttonContainer = Instance.new('Frame')
    buttonContainer.Size = UDim2.new(1, -20, 0, CONFIG.BUTTON.HEIGHT)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.LayoutOrder = #allButtonFrames + 1
    buttonContainer.Parent = parent

    -- Main button (75% width)
    local buttonFrame = Instance.new('Frame')
    buttonFrame.Size = UDim2.new(0.75, -5, 1, 0)
    buttonFrame.Position = UDim2.new(0, 0, 0, 0)
    buttonFrame.BackgroundColor3 = CONFIG.BUTTON.MAIN_COLOR
    buttonFrame.BorderSizePixel = 0
    buttonFrame.Parent = buttonContainer

    local buttonCorner = Instance.new('UICorner')
    buttonCorner.CornerRadius = UDim.new(0, 4)
    buttonCorner.Parent = buttonFrame

    local button = Instance.new('TextButton')
    button.Size = UDim2.new(1, 0, 1, 0)
    button.Position = UDim2.new(0, 0, 0, 0)
    button.BackgroundTransparency = 1
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = text
    button.Font = CONFIG.TEXT.BODY_FONT
    button.TextSize = CONFIG.TEXT.BODY_SIZE
    button.Parent = buttonFrame

    local buttonOutline = Instance.new('UIStroke')
    buttonOutline.Color = Color3.fromRGB(60, 60, 80)
    buttonOutline.Thickness = 1
    buttonOutline.Parent = buttonFrame

    local buttonGradient = Instance.new('UIGradient')
    buttonGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 45)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 25, 35)),
    })
    buttonGradient.Rotation = 90
    buttonGradient.Parent = buttonFrame

    -- Keybind button (25% width)
    local keybindFrame = Instance.new('Frame')
    keybindFrame.Size = UDim2.new(0.25, 0, 1, 0)
    keybindFrame.Position = UDim2.new(0.75, 5, 0, 0)
    keybindFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    keybindFrame.BorderSizePixel = 0
    keybindFrame.Parent = buttonContainer

    local keybindCorner = Instance.new('UICorner')
    keybindCorner.CornerRadius = UDim.new(0, 4)
    keybindCorner.Parent = keybindFrame

    local keybindButton = Instance.new('TextButton')
    keybindButton.Size = UDim2.new(1, 0, 1, 0)
    keybindButton.Position = UDim2.new(0, 0, 0, 0)
    keybindButton.BackgroundTransparency = 1
    keybindButton.TextColor3 = Color3.fromRGB(200, 200, 200)
    keybindButton.Text = defaultKey or 'NONE'
    keybindButton.Font = CONFIG.TEXT.BODY_FONT
    keybindButton.TextSize = CONFIG.TEXT.KEYBIND_SIZE
    keybindButton.Parent = keybindFrame

    local keybindOutline = Instance.new('UIStroke')
    keybindOutline.Color = Color3.fromRGB(70, 70, 90)
    keybindOutline.Thickness = 1
    keybindOutline.Parent = keybindFrame

    local keybindGradient = Instance.new('UIGradient')
    keybindGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 50)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 40)),
    })
    keybindGradient.Rotation = 90
    keybindGradient.Parent = keybindFrame

    -- Store references
    table.insert(allButtonFrames, buttonContainer)
    buttonStates[text] = false
    keybindButtons[text] = {
        frame = keybindFrame,
        button = keybindButton,
        currentKey = defaultKey or 'NONE',
        callback = callback,
    }

    -- Keybind listening
    local listening = false
    keybindButton.MouseButton1Click:Connect(function()
        listening = true
        keybindButton.Text = '...'
        keybindFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 80)

        local connection
        connection = UserInputService.InputBegan:Connect(
            function(input, gameProcessed)
                if gameProcessed then
                    return
                end

                if input.UserInputType == Enum.UserInputType.Keyboard then
                    local key = input.KeyCode.Name
                    updateKeybind(text, key)
                    listening = false
                    keybindFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
                    connection:Disconnect()
                elseif input.UserInputType == Enum.UserInputType.Touch then
                    -- Mobile support for keybinds
                    keybindButton.Text = 'TAP'
                    updateKeybind(text, 'TAP')
                    listening = false
                    keybindFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
                    connection:Disconnect()
                end
            end
        )
    end)

    -- Input handling
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then
            return
        end

        if input.UserInputType == Enum.UserInputType.Keyboard then
            local pressedKey = input.KeyCode.Name
            if
                keybindButtons[text]
                and keybindButtons[text].currentKey == pressedKey
            then
                buttonStates[text] = not buttonStates[text]

                local targetColor = buttonStates[text]
                        and CONFIG.BUTTON.ACTIVE_COLOR
                    or CONFIG.BUTTON.MAIN_COLOR
                local targetOutline = buttonStates[text]
                        and CONFIG.WINDOW.ACCENT_COLOR
                    or Color3.fromRGB(60, 60, 80)

                TweenService:Create(
                    buttonFrame,
                    TweenInfo.new(0.2),
                    { BackgroundColor3 = targetColor }
                ):Play()
                TweenService:Create(
                    buttonOutline,
                    TweenInfo.new(0.2),
                    { Color = targetOutline }
                ):Play()

                if callback then
                    callback(buttonStates[text])
                end
            end
        end
    end)

    -- Hover effects
    local function setupHoverEffects(frame, defaultColor, hoverColor)
        frame.MouseEnter:Connect(function()
            if not (frame == buttonFrame and buttonStates[text]) then
                TweenService:Create(
                    frame,
                    TweenInfo.new(0.1),
                    { BackgroundColor3 = hoverColor }
                ):Play()
            end
        end)

        frame.MouseLeave:Connect(function()
            if not (frame == buttonFrame and buttonStates[text]) then
                TweenService:Create(
                    frame,
                    TweenInfo.new(0.1),
                    { BackgroundColor3 = defaultColor }
                ):Play()
            end
        end)
    end

    setupHoverEffects(
        buttonFrame,
        CONFIG.BUTTON.MAIN_COLOR,
        CONFIG.BUTTON.HOVER_COLOR
    )
    setupHoverEffects(
        keybindFrame,
        Color3.fromRGB(30, 30, 40),
        Color3.fromRGB(50, 50, 60)
    )

    -- Click handling
    button.MouseButton1Click:Connect(function()
        buttonStates[text] = not buttonStates[text]

        local targetColor = buttonStates[text] and CONFIG.BUTTON.ACTIVE_COLOR
            or CONFIG.BUTTON.MAIN_COLOR
        local targetOutline = buttonStates[text] and CONFIG.WINDOW.ACCENT_COLOR
            or Color3.fromRGB(60, 60, 80)

        TweenService:Create(
            buttonFrame,
            TweenInfo.new(0.2),
            { BackgroundColor3 = targetColor }
        ):Play()
        TweenService
            :Create(
                buttonOutline,
                TweenInfo.new(0.2),
                { Color = targetOutline }
            )
            :Play()

        if callback then
            callback(buttonStates[text])
        end
    end)

    return buttonContainer
end

-- Update scroll frame size when buttons are added
buttonLayout:GetPropertyChangedSignal('AbsoluteContentSize'):Connect(function()
    scrollFrame.CanvasSize =
        UDim2.new(0, 0, 0, buttonLayout.AbsoluteContentSize.Y)
end)

-- Window controls functionality
local function setupControlButton(button, hoverColor)
    button.MouseEnter:Connect(function()
        TweenService
            :Create(
                button,
                TweenInfo.new(0.1),
                { BackgroundColor3 = hoverColor }
            )
            :Play()
    end)

    button.MouseLeave:Connect(function()
        TweenService:Create(
            button,
            TweenInfo.new(0.1),
            { BackgroundColor3 = Color3.fromRGB(40, 40, 50) }
        ):Play()
    end)
end

setupControlButton(minimizeBtn, Color3.fromRGB(80, 80, 120))
setupControlButton(closeBtn, Color3.fromRGB(220, 60, 60))

-- Minimize functionality
local isMinimized = false
local function toggleMinimize()
    isMinimized = not isMinimized

    if isMinimized then
        TweenService
            :Create(
                mainFrame,
                TweenInfo.new(
                    0.3,
                    Enum.EasingStyle.Quad,
                    Enum.EasingDirection.Out
                ),
                { Size = CONFIG.WINDOW.MINIMIZED_SIZE }
            )
            :Play()
        scrollFrame.Visible = false
        shadow.Visible = false
        minimizeBtn.Text = '+'
    else
        TweenService
            :Create(
                mainFrame,
                TweenInfo.new(
                    0.3,
                    Enum.EasingStyle.Quad,
                    Enum.EasingDirection.Out
                ),
                { Size = CONFIG.WINDOW.SIZE }
            )
            :Play()
        scrollFrame.Visible = true
        shadow.Visible = true
        minimizeBtn.Text = '−'
    end
end

minimizeBtn.MouseButton1Click:Connect(toggleMinimize)

-- Close functionality
closeBtn.MouseButton1Click:Connect(function()
    TweenService
        :Create(mainFrame, TweenInfo.new(0.2), { BackgroundTransparency = 1 })
        :Play()
    TweenService:Create(shadow, TweenInfo.new(0.2), { ImageTransparency = 1 })
        :Play()
    wait(0.2)
    screenGui:Destroy()
end)

-- Mobile support
if UserInputService.TouchEnabled then
    CONFIG.WINDOW.SIZE = UDim2.new(0, 280, 0, 360)
    CONFIG.WINDOW.MINIMIZED_SIZE = UDim2.new(0, 280, 0, 50)
    CONFIG.BUTTON.HEIGHT = 35
    CONFIG.TEXT.BODY_SIZE = 13
    CONFIG.TEXT.KEYBIND_SIZE = 11

    mainFrame.Size = CONFIG.WINDOW.SIZE
end

-- Load saved keybinds
loadKeybinds()

-- Export function to add buttons from outside
return {
    createButton = function(text, callback, defaultKey)
        return createButton(scrollFrame, text, callback, defaultKey)
    end,

    getButtonState = function(text)
        return buttonStates[text] or false
    end,

    setButtonState = function(text, state)
        if buttonStates[text] ~= nil then
            buttonStates[text] = state
        end
    end,

    destroy = function()
        screenGui:Destroy()
    end,
}
